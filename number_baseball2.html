<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>숫자야구</title>
</head>
<body>
    <form id = 'form'>
      <input type = 'text' id = 'input'>
      <button>확인</button>
    </form>
    <div id = 'logs'></div>
    <script>
      const $input = document.querySelector('#input');
      const $form = document.querySelector('#form');
      const $logs = document.querySelector('#logs');
    
      //1. 숫자를 뽑기위한 배열 만들기
      /*
      const numbers = [];
      for(let i = 0; i < 9; i++){
        numbers.push(i + 1);
      }
      */

      const numbers = Array(9).fill(0).map((element, index) => { //Array(9) -> length가 9인 빈배열 생성, fill(0) ->각 요소를 0으로, map ->기존 배열의 요소를 일대일로 다른 값으로 바꾸어 새로운 배열을 만듦
        return index + 1;
      });
      console.log

      //2. 무작위 숫자 4개 뽑기
      const answer = [];
      for(let i = 0; i < 4; i++){ // 네 번을 반복하면서
        const index = Math.floor(Math.random() * numbers.length); // 0 ~ 8 까지의 정수(인덱스 번호)
        answer.push(numbers[index]); // 1 ~ 9 사이의 정수 한개를 answer에 저장
        numbers.splice(index, 1); // 뽑힌 숫자를 제거(중복 방지)
      }
      console.log(answer);
      //3. 입력값 검증
      const tries = []; // input값을 저장할 빈배열
      function checkInput(input) {  //입력값을 검증하는 함수 (올바른 입력(중복되지 않는 숫자 4개)이 이뤄졌는지 판단하기 위해)
        if (input.length !== 4) {
          return alert('네 자리 숫자를 입력하세요.');
        }
        if (new Set(input).size !== 4){ //중복을 제거한 배열의 요소가 4개인지 검사(중복된 숫자가 있는지 없는지)
          return alert('중복되지 않게 입력하세요.');
        }
        if (tries.includes(input)) { 
          return alert('이미 시도했던 값입니다.');
        }
        return true; 
      }
      //console.log(checkInput('3345'));

      let out = 0;
      $form.addEventListener('submit', (event) => { //form의 기본 동작은 새로고침
        event.preventDefault(); //기본 동작 방지
        const value = $input.value;
        $input.value = '';
        if(!checkInput(value)){ //checkInput(입력값 검증)에서 탈락하는 경우(조건문을 만족하는 경우), alert창 return이후 값으로 undefined반환
          return; //undefined는 false이므로 입력값 검증에서 탈락하는 경우 해당 조건문을 만족하게 됨 
        }
        if(answer.join('') === value) { //입력값과 answer(정답)이 일치하면 join -> 배열을 문자열로
          $logs.textContent = '홈런!';
          return;
        }
        if(tries.length >= 9){ //10번의 시도를 했을 때 까지(즉, 실패) 
          const message = document.createTextNode(`${value}: 패배! 정답은 ${answer.join('')}`); //createTextNode -> 텍스트를 만들고
          $logs.appendChild(message); //appendChild로 텍스트를 추가(createTextNode로 텍스트를 만들어야 appendChild 사용 가능)
          return;
        }
        //4. 게임 조건 판단(몇 스트라이크 몇 볼인지)

        let strike = 0;
        let ball = 0;
        answer.forEach((element, i) => { //각각의 요소와 index에 대해 함수를 실행. forEach는 반복문 효과를 냄. 인수로 함수를 넣고, 함수가 각각의 배열 요소들에 순서대로 적용되는 구조
          const index = value.indexOf(element) //value의 index
          if(index > -1){
            if(index === i){ // value의 index와 answer의 index가 같을 때 즉, 같은 자리
              strike++;
            }
            else{
              ball++;
            }
          }
        })

        /*
        let strike = 0;
        let ball = 0;
        //4-1 아웃 추가
        //let out = 0; ->입력값이 submit 될 때 마다 strike와 ball을 기준으로 out을 카운팅해야하므로 out변수는 submit event의 바깥에 위치해야한다
        //이 위치에 out에 대한 변수가 있으면 입력값 submit이후 다시 0으로 초기화 되고, out조건이 만족 되어도 1out만 반복 됨
        for(let i = 0; i < answer.length; i++){
          const index = value.indexOf(answer[i]); //answer의 요소가 입력값(value)에 있는지 -> 있으면 > -1 
          if(index > -1) { // 없으면 = -1, 있으면 > -1(인덱스 번호가 나오므로)
            if(index === i){ //있는데 인덱스 번호(자릿수)까지 같으면
              strike += 1; //스트라이크
            } 
            else { // 아니면
              ball += 1; //볼
            }
          }
        }
        */

        if (strike === 0 && ball === 0){
          out += 1;
          $logs.append(`${out} 아웃`, document.createElement('br'));
        }
        else{
        $logs.append(`${value}: ${strike} 스트라이크 ${ball} 볼`, document.createElement('br')); //문자열과 br태그 추가 //append는 createTextNode로 문자열을 만들지 않고도 바로 문자열 추가 및 ,(콤마)로 여러개 추가 가능
        }
        if(out === 3){
          $logs.append(`패배 했습니다. 정답은 ${answer.join('')} 입니다`);
          return;
        }
        
        tries.push(value);
      });
      
    </script>
</body>
</html>