<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>숫자야구</title>
</head>
<body>
    <form id = 'form'>
      <input type = 'text' id = 'input'>
      <button>확인</button>
    </form>
    <div id = 'logs'></div>
    <script>
      const $input = document.querySelector('#input');
      const $form = document.querySelector('#form');
      const $logs = document.querySelector('#logs');

      //1. 무작위로 숫자 뽑기
      //네 개의 숫자는 중복되지 않아야함에 유의
      //Math.random() -> 0 =< x < 1 , 0 이상 1 미만의 숫자를 무작위로 생성(자연수만 생성하는 것이 아님)
      //Math.random()은 완전한 무작위가 아니며 비밀번호를 생성한다던가 할 때는 window.crypto.getRandomValues() 함수가 따로 존재
      
      //여러개의 값을 모아둘 때 배열과 객체 중에 무엇을 사용해야 하는가?
      //-> 배열을 사용하는지, 객체를 사용하는지에 따라 프로그램 구조가 바뀌고 코딩의 효율성과 성능에 상당한 차이가 난다
      //-> 간단하게 고르는 방법은 단순한 값의 나열이면 배열, 값에 이름이 붙는다면 객체를 사용

      
      const numbers = []; // 1 ~ 9까지의 숫자를 저장할 배열
      for(let i = 1; i < 10; i++){
        numbers.push(i);
      }
      
      const answer = []; //numbers에 저장된 숫자를 꺼내올 배열
      for(let i = 0; i < 4; i++){ //총 4번 반복
        //const index = Math.floor(Math.random() * 9); // 0 ~ 8 까지의 정수
        const index = Math.floor(Math.random() * numbers.length); // splice로 줄어드는 numbers의 배열의 길이와 맞추기 위해 * numbers.length;
        answer.push(numbers[index]); //numbers에 담겨있는 숫자를 하나 뽑아오고
        numbers.splice(index, 1); // 중복을 제거하기 위해 뽑아온 숫자는 numbers배열에서 제거
      }
      //console.log(answers);
      

      //2. 입력값 검증
      //보통 입력창(input)이 있으면 <form>태그로 감싸서 submit이벤트를 사용하는 것이 좋음 -> 버튼을 클릭하지 않고도 Enter를 눌러서 값을 제출 할 수 있음
      const tries = [];
      function checkInput(input){ 
        if(input.length !== 4) { //숫자가 4자리인지 검증
          return alert('4자리 숫자를 입력하세요.');
        }
        if(new Set(input).size !== 4) { // 중복된 숫자가 있는지
          return alert('숫자는 중복되지 않게 입력하세요.');
        }
        if(tries.includes(input)){ // 이미 시도한 값인지
          return alert('이미 시도한 값입니다.');
        }
        return true;
      }

      $form.addEventListener('submit', (event) => {
        event.preventDefault(); // 폼 태그의 기본 동작을 취소. 폼 태그는 submit이벤트가 발생하면 기본으로 브라우저를 새로고침함. 새로고침 되면 모든 것이 초기화 되므로 이를 방지
        const value = $input.value; // 입력값은 value변수에 저장
        $input.value = '';  // 화면에 보이는 입력값을 지우고
        const valid = checkInput(value); // 입력값에 대한 검증을 함
        //3. 입력값과 정답을 비교
        if(answer.join('') === value) {
          $logs.textContent = '홈런입니다';
          return;
        }
        if(tries.length >= 9) {
          const message = document.createTextNode(`패배! 정답은 ${answer.join('')}`);// 기존 $logs 태그의 내용을 유지하면서 다음 줄에 기록을 남기기 위해 createTextNode로 텍스트를 먼저 만들고
          $logs.appendChild(message); // appendChild로 화면에 추가. textContnet를 사용하면 기존 내용이 사라져버림
          return;
        }

        // 몇 스트라이크 몇 볼인지 검사
        let strike = 0;
        let ball = 0;
        for(let i = 0; i < answer.length; i++){
          const index = value.indexOf(answer[i]);
          if(index > -1){ // 일치하는 숫자를 발견했다면
            if( index === i){ // 그리고 자릿수도 같다면
              strike += 1;
            } else { //숫자만 같다면
              ball += 1;
            }
          }
        }
        $logs.append(`${value}: ${strike} 스트라이크 ${ball} 볼`, document.createElement('br'));
        tries.push(value);
        });

    </script>
</body>
</html>